# 网络面试题总结（Markdown 版）

> 覆盖 TCP/IP 基础、HTTP/HTTPS、HTTP/2/HTTP/3、DNS、CDN、负载均衡与代理、NAT/防火墙、Linux 网络与排查、性能与可靠性优化、云原生网络（K8s/CNI）、安全与协议细节、常见场景题与动手题。高频考点与追问路径，含命令速查与实践建议。

## 目录
- 基础与分层模型
- TCP 机制与细节
- UDP 与实时应用
- HTTP/HTTPS 与演进
- DNS 与 CDN
- 代理与负载均衡
- NAT、防火墙与传输细节
- Linux 网络与排查
- 性能优化与可靠性
- 云原生网络（Kubernetes/CNI）
- 安全与合规
- 高频面试题（含要点）
- 实战动手题
- 命令速查

---

## 基础与分层模型
- OSI 七层 vs TCP/IP 四层：应用/传输/网络/链路；定位问题从上到下逐层分析
- 数据封装：应用数据 → TCP/UDP 段 → IP 包 → 以太网帧；MTU/MSS 对分片与性能的影响
- 常用地址与端口：公网/私网（`10/172.16/192.168`）、保留端口与服务习惯（`80/443/22/53` 等）

## TCP 机制与细节
- 连接建立与释放：三次握手、四次挥手；`SYN`、`FIN`、`TIME_WAIT` 与端口耗尽
- 重传与确认：`Fast Retransmit`、`SACK`；`dupACK` 的意义
- 流量控制：滑动窗口、`rwnd` 与发送端控制；`ZeroWindow` 场景
- 拥塞控制：`slow start`、`congestion avoidance`、`fast recovery`；CUBIC/BBR 的差异
- Nagle 与 Delayed ACK：合并小包 vs 延迟确认；交互场景建议关闭 Nagle（`TCP_NODELAY`）
- Keepalive 与长连接：心跳/保活；空闲连接清理与负载均衡的影响
- 半连接队列与全连接队列：`backlog` 调优；SYN flood 防护（syn cookies）

## UDP 与实时应用
- 无连接、无拥塞控制：丢包与乱序由应用处理；适合实时媒体、DNS、QUIC
- 可靠传输自定义：FEC、重传策略、序列号与滑窗（如 RTP/RTCP 的配合）

## HTTP/HTTPS 与演进
- HTTP/1.1：文本协议、队头阻塞；长连接与管线化的局限
- HTTPS/TLS：握手流程（密钥交换/证书链/对称加密）、SNI、ALPN、HSTS；mTLS 双向认证
- HTTP/2：二进制分帧、单连接多路复用、头压缩（HPACK）、优先级；解决队头阻塞
- HTTP/3/QUIC：基于 UDP 的加密传输、连接迁移、快速握手；弱网络与移动场景更优

## DNS 与 CDN
- 解析流程：递归与迭代、根/顶级域/权威；`A/AAAA/CNAME/TXT/MX/SRV` 记录
- 缓存与 TTL：就近解析与延迟；DNS 污染与劫持的识别（`dig +trace`）
- CDN：边缘节点、缓存策略、分层回源；一致性与清缓存策略；命中率与回源率指标

## 代理与负载均衡
- 正向/反向代理：Nginx/Envoy/Haproxy；七层 vs 四层代理的适用场景
- 负载算法：轮询、最小连接、加权、源地址哈希、一致性哈希（会话亲和）
- 健康检查与熔断：主动/被动探测；异常比例与 RT 阈值；灰度与金丝雀发布

## NAT、防火墙与传输细节
- NAT 类型：源 NAT、目的 NAT；PAT（端口映射）；NAT 穿越（STUN/TURN）
- 防火墙：状态检测、防护策略、白名单；`iptables`/`nftables`、安全组（云）
- MTU/MSS：路径 MTU 发现（PMTUD）；分片与性能（避免中间设备丢片）
- QoS 与流控：优先级、限速、队列管理；缓冲膨胀（bufferbloat）问题与治理

## Linux 网络与排查
- 连接与端口：`ss -tanp`、`lsof -i`、`netstat -s`
- 路由与链路：`ip a`、`ip r`、`ip neigh`、`ethtool`、`mtr`/`traceroute`
- 抓包与分析：`tcpdump -i any -w trace.pcap`、Wireshark；过滤语法与常见字段
- 系统参数：`sysctl`（`net.core.somaxconn`、`net.ipv4.tcp_tw_reuse` 等）；文件描述符与`ulimit`

## 性能优化与可靠性
- 连接层：`backlog`、端口复用（SO_REUSEPORT）、亲和与多队列
- 传输层：禁用 Nagle（`TCP_NODELAY`）适用于低时延交互；启用 BBR 优化弱网吞吐
- 应用层：连接池与复用、请求合并、压缩与缓存；幂等设计与重试退避
- 边界与代理：合理超时、健康检查与负载策略；避免多层重试叠加雪崩

## 云原生网络（Kubernetes/CNI）
- CNI：容器网络接口；实现（Calico/Flannel/Cilium）与差异（路由/BPF/策略）
- Service：`ClusterIP`/`NodePort`/`LoadBalancer`/Headless；选择依据与 DNS 解析
- kube-proxy：`iptables` vs `ipvs`；性能与可观测性差异
- Ingress/Gateway API：七层路由与网关能力；金丝雀与灰度实践
- NetworkPolicy：默认拒绝与白名单；东西向隔离

## Netty 与 BIO/NIO/AIO
- 定位与关系：BIO/NIO/AIO 是 Java I/O 模型；Netty 基于 NIO 与操作系统原生事件机制（epoll/kqueue）提供高性能网络框架
- BIO：阻塞 I/O，每连接阻塞读写，易上手但扩展性差
- NIO：非阻塞通道+选择器，事件驱动，单线程管理多连接；需自行处理拆包/黏包与缓冲管理
- AIO：NIO.2 异步通道；受平台支持限制，Linux 套接字常由线程池模拟，收益不一定优于 NIO
- Netty 核心原理：
  - 事件循环：`EventLoopGroup` 管理线程，`boss` 接入，`worker` 读写；单线程绑定多 `Channel`
  - Pipeline 与 Handler：`ChannelPipeline` 串联入站/出站 `ChannelHandler`；编解码器将字节流↔消息对象
  - ByteBuf 与内存：池化、零拷贝、引用计数；水位线与背压控制写入压力
  - 原生传输：启用 `native-transport` 使用 epoll/kqueue 提升性能
- 生态映射：Spring WebFlux→Reactor Netty，Dubbo/gRPC→Netty 传输，部分客户端与中间件内置 Netty
- 何时用：自定义二进制协议、海量长连接推送/IM、高性能网关与代理、HTTP/2/WebSocket 等对性能与控制要求高的场景
- 何时不直接用：标准 Web/REST 已有成熟服务器与网关；主要瓶颈在业务/数据库
- 面试要点：事件循环与线程模型、Pipeline/Handler、ByteBuf、背压与水位线、原生传输启用与优势、拆包/黏包治理（`LengthFieldBasedFrameDecoder`）

## 安全与合规
- TLS 最佳实践：安全套件、证书轮换、OCSP stapling；HSTS、CSP、Referrer Policy
- 鉴权与令牌：OAuth2/OIDC、JWT；跨域（CORS）与防 CSRF
- 输入输出净化：避免注入与越权；速率限制与配额；审计与合规（PII 脱敏、数据驻留）

## 高频面试题（含要点）
- 三次握手/四次挥手的每一步含义？
  - `SYN` 同步序列号；`ACK` 确认；挥手的半关闭与 `TIME_WAIT` 的必要性
- 为什么需要 `TIME_WAIT`？如何治理端口耗尽？
  - 避免延迟包污染后续连接；端口复用/SO_REUSEADDR、缩短等待（有代价）
- TCP 与 UDP 的差异与应用场景？
  - 有连接/可靠 vs 无连接/不可靠；RPC/HTTP vs 视频/游戏/QUIC
- HTTP/2 的多路复用如何工作？与 HTTP/1.1 的差异？
  - 二进制分帧、流与优先级；解决队头阻塞；头压缩
- TLS 握手流程与性能优化？
  - 证书链、密钥交换、会话复用、0‑RTT（需防重放）
- DNS 解析与缓存策略如何影响延迟？
  - TTL、就近解析、域名层级；`dig +trace` 排查
- 负载均衡如何选择算法与健康检查？
  - 轮询/最小连接/一致性哈希；主动探测与被动熔断
- NAT 穿越与 WebRTC 如何实现？
  - STUN/TURN；候选收集与协商
- 常见网络性能问题如何定位？
  - 丢包与重传、RT 上升、队头阻塞、缓冲膨胀；端到端抓包与指标结合
- K8s 网络策略如何隔离租户？
  - 默认拒绝 + 明确白名单；基于标签与命名空间匹配

## 实战动手题
- 排查高 RT 接口：
  - 采集 `ss`/`tcpdump`/`mtr` → 分析握手延迟/重传/队头阻塞 → 调整 `TCP_NODELAY`、代理策略与缓存
- 配置 HTTPS 最佳实践：
  - 强制 TLS1.2+/安全套件/证书自动轮换；HSTS/CSP；ALPN/HTTP/2
- 搭建 Nginx 反向代理与负载：
  - 配置上游、健康检查、会话亲和；灰度/金丝雀路由
- K8s Ingress 灰度发布：
  - 两套服务按 Header/权重路由；失败快速回滚
- DNS 与 CDN 调优：
  - 合理 TTL；多地监测；缓存命中率优化与分层回源控制

## 命令速查
- 链路：`ping <host>`、`mtr <host>`、`traceroute <host>`
- 连接：`ss -tanp`、`lsof -i :<port>`、`netstat -s`
- 抓包：`tcpdump -i any port 443 -w tls.pcap`、`tcpdump -nn -vvv -s 0`
- DNS：`dig A <domain>`、`dig +trace <domain>`、`nslookup`、`host`
- 路由与网卡：`ip a`、`ip r`、`ip neigh`、`ethtool -S <iface>`
- 系统参数：`sysctl -a | grep net`、`sysctl -w net.core.somaxconn=4096`

---

如需将此文档扩展为“带图示与完整实践示例”的进阶版，或根据你的技术栈（Web/移动/后端/K8s）生成专属题目与参考答案，请告诉我偏好与深度。